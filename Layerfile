# Use Ubuntu 18.04 as the base image
FROM vm/ubuntu:18.04

# Install Node.js (using a more recent version)
RUN curl -sL https://deb.nodesource.com/setup_14.x | bash && \
    apt install nodejs && \
    rm -f /etc/apt/sources.list.d/nodesource.list

# Debug: Show contents of package.json
RUN cat package.json

# Install project dependencies
COPY package.json package-lock.json ./
RUN npm ci

# Explicitly install axios
RUN npm install axios

# Copy the rest of the application code
COPY . .

# Create .env file with environment variables
RUN echo "OPENWEATHERMAP_API_KEY=your_openweathermap_api_key_here" > .env && \
    echo "MAPBOX_TOKEN=your_mapbox_token_here" >> .env

# Install nodemon for development
RUN npm install -g nodemon

# Debug: List installed packages
RUN npm list

# Start the Express server using nodemon
RUN BACKGROUND nodemon ./bin/www

# Expose the application
EXPOSE WEBSITE http://localhost:3000